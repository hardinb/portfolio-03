---
title: "Portfolio_3"
author: "Ben Hardin"
date: "2023-02-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load-data-packages}
library(tidyverse)
library(jsonlite)
```

```{r load-data}
spotify <- "StreamingHistory0.JSON" %>%
  fromJSON() %>%
  as_tibble() %>%
  glimpse()
```

```{r music}
spotify %>%
  count(artistName) %>%
  arrange(desc(n))

spotify <- spotify %>%
  filter(!artistName %in% c("Very Bad Wizards", "Unknown Artist", "Decoding the Gurus", "Taskmaster The Podcast", "Two Psychologists Four Beers", "Better Call Saul Insider Podcast", "Off Menu with Ed Gamble and James Acaster"))

spotify <- spotify %>%
  group_by(artistName) %>%
  mutate(plays = n())
```

```{r getting-top-artists}
spotify_top <-  spotify %>%
  filter(plays >= 40)

spotify_top %>%
  count(artistName) %>%
  arrange(desc(n))
```

```{r first-plot}
ggplot(spotify_top, aes(y = artistName, x = endTime, color = artistName))+
  geom_point(position = "jitter")+
  theme(axis.text.y = element_blank())
```

```{r date-package}
library(lubridate)
```

```{r reshaping}
spotify_top$month <- month(ymd_hm(spotify_top$endTime))

spotify_top <- spotify_top %>%
  group_by(month, artistName) %>%
  mutate(monthly_plays = n())

spotify_monthly <- aggregate(monthly_plays ~ month + artistName, data = spotify_top, FUN = mean)
```

```{r better-plot}
ggplot(spotify_monthly, aes(x = month, y = monthly_plays, color = artistName))+
  geom_line()
```

```{r being-selective}
spotify_top8 <-  spotify_top %>%
  filter(plays > 80)

spotify_monthly <- aggregate(monthly_plays ~ month + artistName + plays, data = spotify_top8, FUN = mean)
```

```{r base-plot}
ggplot(spotify_monthly, aes(x = month, y = monthly_plays, color = fct_reorder(artistName, plays, .desc = TRUE)))+
  geom_line(linewidth = 1.3)
```

### Make it better

```{r improve-plot, fig.width = 10}
spotify_monthly <- spotify_monthly %>%
  mutate(month_name = month.name[spotify_monthly$month])

ggplot(spotify_monthly, aes(x = fct_reorder(month_name, month), y = monthly_plays, group = fct_reorder(artistName, plays, .desc = TRUE), color = fct_reorder(artistName, plays)))+
  geom_line(lineend = "round", aes(linewidth = fct_reorder(artistName, plays)))+
  scale_color_viridis_d()+
  theme_bw()+
  labs(title = "Listening Trends for Ben's top artists (2022)",
       x = "Month",
       y = "Plays",
       color = "Artist",
       linewidth = "Artist")
```

```{r even-better, fig.width = 10}
spotify_monthly <- spotify_monthly %>%
  mutate(month_name = month.name[spotify_monthly$month])

ggplot(spotify_monthly, aes(x = fct_reorder(month_name, month), y = monthly_plays, group = fct_reorder(artistName, plays, .desc = TRUE), color = fct_reorder(artistName, plays)))+
  geom_line(lineend = "round", 
            aes(linewidth = fct_reorder(artistName, plays)))+
  guides(color = guide_legend(reverse = TRUE), linewidth = guide_legend(reverse = TRUE))+
  scale_color_viridis_d(option = "F", direction = 1)+
  theme_classic()+
  theme(
    legend.position = c(.95, .95),
    legend.justification = c("right", "top"),
    legend.box.just = "right",
    legend.margin = margin(6, 6, 6, 6))+
  labs(title = "Listening Trends for Ben's top artists (2022)",
       x = "Month",
       y = "Plays",
       color = "Ben's top artists",
       linewidth = "Ben's top artists")
```